{"ast":null,"code":"var _jsxFileName = \"/Users/doyoungkim/Library/Mobile Documents/com~apple~CloudDocs/\\uD835\\uDDD7\\uD835\\uDFEC\\uD835\\uDFEC\\uD835\\uDFEE/ITU/Project/ITU-Name/client/src/components/Basket/AddToCartButton.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport styles from './AddToCartButton.module.css';\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { v4 as uuidv4 } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AddToCartButton = ({\n  product,\n  selectedSize\n}) => {\n  _s();\n  const [isAdded, setIsAdded] = useState(product.isAdded);\n  const {\n    user\n  } = useAuth();\n  useEffect(() => {\n    setIsAdded(product.isAdded);\n  }, [product.isAdded]);\n  const ensureBasketExists = async basketId => {\n    try {\n      const basketResponse = await fetch(`/baskets/${basketId}`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          products: []\n        })\n      });\n      if (!basketResponse.ok) {\n        const errorText = await basketResponse.text();\n        throw new Error(`Failed to create basket: ${errorText}`);\n      }\n      console.log('Basket created successfully:', await basketResponse.json());\n    } catch (error) {\n      console.error(\"Error ensuring basket exists:\", error);\n    }\n  };\n  const addToBasket = async basketId => {\n    try {\n      const newBasketProduct = {\n        product_id: product.product_id,\n        product_name: product.product_name,\n        price: product.price,\n        color: product.color,\n        amount: 1,\n        size: selectedSize\n      };\n      const response = await fetch(`/baskets/${basketId}/products`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(newBasketProduct)\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to add product to basket\");\n      }\n    } catch (error) {\n      console.error(\"Error adding product to basket:\", error);\n    }\n  };\n  const handleAddToCartClick = async () => {\n    let basketId = user === null || user === void 0 ? void 0 : user.username;\n    if (!basketId) {\n      basketId = localStorage.getItem('basketId') || undefined;\n      if (!basketId) {\n        basketId = uuidv4();\n        localStorage.setItem('basketId', basketId);\n      }\n    }\n    await ensureBasketExists(basketId);\n    await addToBasket(basketId);\n    setIsAdded(true);\n    setTimeout(() => {\n      setIsAdded(false);\n    }, 1000);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.select_size_btn,\n      style: {\n        display: selectedSize || isAdded ? 'none' : 'block'\n      },\n      children: \"Select size\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.add_cart_btn,\n      style: {\n        display: selectedSize && !isAdded ? 'block' : 'none'\n      },\n      onClick: handleAddToCartClick,\n      children: \"Add to cart\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.add_cart_btn_added,\n      style: {\n        display: isAdded ? 'block' : 'none'\n      },\n      children: \"Added\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 9\n  }, this);\n};\n_s(AddToCartButton, \"WOpcEM33WI/p/QIVlqugAS9UCLE=\", false, function () {\n  return [useAuth];\n});\n_c = AddToCartButton;\nexport default AddToCartButton;\nvar _c;\n$RefreshReg$(_c, \"AddToCartButton\");","map":{"version":3,"names":["React","useState","useEffect","styles","useAuth","v4","uuidv4","jsxDEV","_jsxDEV","AddToCartButton","product","selectedSize","_s","isAdded","setIsAdded","user","ensureBasketExists","basketId","basketResponse","fetch","method","headers","body","JSON","stringify","products","ok","errorText","text","Error","console","log","json","error","addToBasket","newBasketProduct","product_id","product_name","price","color","amount","size","response","handleAddToCartClick","username","localStorage","getItem","undefined","setItem","setTimeout","children","className","select_size_btn","style","display","fileName","_jsxFileName","lineNumber","columnNumber","add_cart_btn","onClick","add_cart_btn_added","_c","$RefreshReg$"],"sources":["/Users/doyoungkim/Library/Mobile Documents/com~apple~CloudDocs/ùóóùü¨ùü¨ùüÆ/ITU/Project/ITU-Name/client/src/components/Basket/AddToCartButton.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport styles from './AddToCartButton.module.css';\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\ninterface AddToCartButtonProps {\r\n    product: {\r\n        product_id: number;\r\n        selectedSize: string | null;\r\n        isAdded: boolean;\r\n        product_name: string;\r\n        price: number;\r\n        imgUrls: string[];\r\n        color: string;\r\n        colorBox: string;\r\n    };\r\n    selectedSize: string | null;\r\n}\r\n\r\nconst AddToCartButton: React.FC<AddToCartButtonProps> = ({ product, selectedSize }) => {\r\n    const [isAdded, setIsAdded] = useState(product.isAdded);\r\n    const { user } = useAuth();\r\n\r\n    useEffect(() => {\r\n        setIsAdded(product.isAdded);\r\n    }, [product.isAdded]);\r\n\r\n    const ensureBasketExists = async (basketId: string) => {\r\n        try {\r\n            const basketResponse = await fetch(`/baskets/${basketId}`, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({ products: [] })\r\n            });\r\n\r\n            if (!basketResponse.ok) {\r\n                const errorText = await basketResponse.text();\r\n                throw new Error(`Failed to create basket: ${errorText}`);\r\n            }\r\n\r\n            console.log('Basket created successfully:', await basketResponse.json());\r\n        } catch (error) {\r\n            console.error(\"Error ensuring basket exists:\", error);\r\n        }\r\n    };\r\n\r\n    const addToBasket = async (basketId: string) => {\r\n        try {\r\n\r\n                const newBasketProduct = {\r\n                    product_id: product.product_id,\r\n                    product_name: product.product_name,\r\n                    price: product.price,\r\n                    color: product.color,\r\n                    amount: 1,\r\n                    size: selectedSize,\r\n                };\r\n\r\n                const response = await fetch(`/baskets/${basketId}/products`, {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\",\r\n                    },\r\n                    body: JSON.stringify(newBasketProduct),\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(\"Failed to add product to basket\");\r\n\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error adding product to basket:\", error);\r\n        }\r\n    };\r\n\r\n    const handleAddToCartClick = async () => {\r\n        let basketId: string | undefined = user?.username;\r\n\r\n        if (!basketId) {\r\n            basketId = localStorage.getItem('basketId') || undefined;\r\n            if (!basketId) {\r\n                basketId = uuidv4();\r\n                localStorage.setItem('basketId', basketId);\r\n            }\r\n        }\r\n\r\n        await ensureBasketExists(basketId);\r\n        await addToBasket(basketId);\r\n        setIsAdded(true);\r\n\r\n        setTimeout(() => {\r\n            setIsAdded(false);\r\n        }, 1000);\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <button className={styles.select_size_btn} style={{ display: selectedSize || isAdded ? 'none' : 'block' }}>\r\n                Select size\r\n            </button>\r\n            <button className={styles.add_cart_btn} style={{ display: selectedSize && !isAdded ? 'block' : 'none' }} onClick={handleAddToCartClick}>\r\n                Add to cart\r\n            </button>\r\n            <button className={styles.add_cart_btn_added} style={{ display: isAdded ? 'block' : 'none' }}>\r\n                Added\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AddToCartButton;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}